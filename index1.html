<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Diabetes Chatbot</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
   <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(to right, #4facfe, #00f2fe);
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
    }

    #chat_container {
      width: 100%;
      max-width: 800px;
      max-height: 600px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    #chat_log {
      padding: 20px;
      height: 500px;
      overflow-y: auto;
      border-bottom: 1px solid #ddd;
      background: #f9f9f9;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #user_input {
      padding: 15px;
      border: none;
      width: calc(100% - 120px); /* Adjusted for icons */
      border-top: 1px solid #ddd;
      outline: none;
      border-radius: 5px;
      font-size: 16px;
    }

    .icons-container {
      display: flex;
      align-items: center;
      margin-left: auto;
    }

    .icons-container i {
      font-size: 24px; /* Medium size for icons */
      color: green; /* Green color */
      margin-left: 10px; /* Space between the icons */
      cursor: pointer;
    }

    button {
      padding: 15px;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      margin-left: 5px;
    }

    #appointment_btn {
      background-color: #ffc107;
    }

    #appointment_btn:hover {
      background-color: #e0a800;
    }

    .message {
      margin: 10px 0;
      padding: 15px;
      border-radius: 15px;
      max-width: 80%;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .user-message {
      align-self: flex-end;
      background: linear-gradient(111.4deg, rgba(238,113,113,1) 1%, rgba(246,215,148,1) 58%);
    }

    .bot-message {
      align-self: flex-start;
      background: radial-gradient(circle 311px at 8.6% 27.9%, rgba(62,147,252,0.57) 12.9%, rgba(239,183,192,0.44) 91.2%);
    }

    .header {
      background-color: #fff;
      text-align: center;
      border-radius: 10px 10px 0 0;
      color: black;
    }

    .footer {
      display: flex;
      align-items: center;
      padding: 10px;
    }

    @media (min-width: 1024px) {
      body {
          padding: 40px;
      }

      #chat_container {
          max-width: 1000px; /* Increase width for laptop screens */
          height: 650px;
          padding: 20px;
      }

      #chat_log {
          height: 550px;
      }

      #user_input {
          font-size: 18px;
      }

      button, .icons-container i {
          font-size: 18px; /* Slightly larger buttons and icons on laptop */
      }
    #hospital_data {
      display: none; /* Hide initially */
      padding: 20px;
      background: #f0f0f0;
      border-top: 1px solid #ddd;
    }
    .hospital {
      background: #fff;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    }
   </style>
</head>
<body> 
   <div id="chat_container">
      <div class="header">
        <h2>DiaBot</h2>
      </div>
      <div id="chat_log"></div>
      <div id="hospital_data"></div> <!-- Container for hospital data -->
      <div class="footer">
        <input type="text" id="user_input" placeholder="Type your message here...">
        <div class="icons-container">
            <i class="fas fa-paper-plane" id="send_icon"></i>
            <i class="fas fa-microphone" id="voice_icon"></i>
        </div>
        <button id="appointment_btn">Book Appointment</button>
      </div>
   </div>

   <script>
    // Fetch hospital data from JSON when appointment query is triggered

    // Existing chat functionalities
    const sendIcon = document.getElementById('send_icon');
    const voiceIcon = document.getElementById('voice_icon');
    const userInput = document.getElementById('user_input');
    const chatLog = document.getElementById('chat_log');
    const appointmentBtn = document.getElementById('appointment_btn');

    sendIcon.addEventListener('click', sendMessage);

    userInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });

    function sendMessage() {
        const message = userInput.value;
        if (message.trim() !== "") {
            appendMessage(message, 'user');
            userInput.value = ''; // Clear input
            fetchResponse(message);
        }
    }

    voiceIcon.addEventListener('click', () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';

        recognition.onresult = function(event) {
            const speechToText = event.results[0][0].transcript;
            userInput.value = speechToText;
            appendMessage(speechToText, 'user');
            fetchResponse(speechToText);
        };

        recognition.start();
    });

    function appendMessage(message, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}-message`;
        messageDiv.innerHTML = `${sender === 'user' ? 'User: ' : 'Bot: '}${message}`;
        chatLog.appendChild(messageDiv);
        chatLog.scrollTop = chatLog.scrollHeight;
    }

    function fetchResponse(message) {
        const appointmentQuery = "i want to book an appointment";
        if (message.toLowerCase().includes(appointmentQuery)) {
            fetchHospitalData(); // Load and display hospitals if appointment query is detected
            return;
        }
        


        fetch('/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ user_input: message }),
        })
        .then(response => response.json())
        .then(data => {
            appendMessage(data.response, 'bot');
        })
        .catch(error => console.error('Error:', error));
    }

    appointmentBtn.addEventListener('click', () => {
    window.location.href = 'appointments1.html';
});

   </script>
</body>
</html>
